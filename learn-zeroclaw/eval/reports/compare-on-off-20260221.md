# RE-TRAC 开关对照结论（timeout=30s，2026-02-21）

## 评测口径

- 任务集：`baseline_tasks_full.jsonl`（20 题）
- 重复次数：`repeats=3`（共 60 次）
- 网关超时：`REQUEST_TIMEOUT_SECS = 30`
- 模型：`moonshotai/kimi-k2.5`（via OpenRouter）
- 对照组：
  - ON：`trajectory_compression_enabled = true`（Phase A + Phase B 完整启用）
  - OFF：`trajectory_compression_enabled = false`

数据来源：

- ON 原始数据：`retrac-on-20260221-raw.jsonl`
- ON 汇总：`retrac-on-20260221-summary.md`
- OFF 原始数据：`retrac-off-20260221-raw.jsonl`
- OFF 汇总：`retrac-off-20260221-summary.md`

---

## 核心指标对比

| 指标 | ON（压缩开启） | OFF（压缩关闭） | 变化 |
|---|---:|---:|---:|
| Success rate | 66.67% | 55.00% | **+11.67pp** |
| Success runs | 40/60 | 33/60 | +7 |
| Avg latency | 22562.00 ms | 24483.15 ms | **-1921.15 ms** |
| P95 latency | 30005 ms | 30005 ms | 持平 |
| Avg iterations | 1.27 | 1.36 | -0.09 |
| Avg tool calls | 0.52 | 0.27 | +0.25 |
| http_error 次数 | 20 | 27 | **-7** |

---

## 逐任务对比

| Task ID | ON 成功% | OFF 成功% | Δ成功% | ON 延迟(ms) | OFF 延迟(ms) | Δ延迟(ms) |
|---|---:|---:|---:|---:|---:|---:|
| smoke-001 | 66.67 | 100.00 | **-33.33** | 17121 | 11036 | +6085 |
| smoke-002 | 33.33 | 100.00 | **-66.67** | 27787 | 19360 | +8427 |
| smoke-003 | 33.33 | 33.33 | 0.00 | 29476 | 28342 | +1134 |
| smoke-004 | 100.00 | 66.67 | **+33.33** | 17158 | 21443 | -4285 |
| smoke-005 | 100.00 | 100.00 | 0.00 | 25280 | 22596 | +2684 |
| baseline-006 | 66.67 | 33.33 | **+33.33** | 25088 | 29167 | -4079 |
| baseline-007 | 66.67 | 33.33 | **+33.33** | 22052 | 28044 | -5992 |
| baseline-008 | 66.67 | 66.67 | 0.00 | 21290 | 20120 | +1170 |
| baseline-009 | 0.00 | 33.33 | **-33.33** | 30003 | 25916 | +4087 |
| baseline-010 | 66.67 | 0.00 | **+66.67** | 23877 | 30002 | **-6125** |
| baseline-011 | 100.00 | 100.00 | 0.00 | 23829 | 20547 | +3282 |
| baseline-012 | 100.00 | 0.00 | **+100.00** | 23206 | 30004 | **-6798** |
| baseline-013 | 100.00 | 33.33 | **+66.67** | 10695 | 29952 | **-19257** |
| baseline-014 | 66.67 | 66.67 | 0.00 | 22250 | 24960 | -2710 |
| baseline-015 | 0.00 | 33.33 | **-33.33** | 30005 | 28714 | +1291 |
| baseline-016 | 66.67 | 0.00 | **+66.67** | 19897 | 30005 | **-10108** |
| baseline-017 | 100.00 | 100.00 | 0.00 | 18260 | 18659 | -399 |
| baseline-018 | 100.00 | 100.00 | 0.00 | 20695 | 16030 | +4665 |
| baseline-019 | 0.00 | 33.33 | **-33.33** | 30004 | 28864 | +1140 |
| baseline-020 | 100.00 | 66.67 | **+33.33** | 13268 | 25902 | **-12634** |

---

## 结果解读

### 1. 成功率提升显著（+11.67pp）

开启 RE-TRAC 后成功率从 55.00% 提升到 66.67%，超时失败（`http_error`）从 27 次降到 20 次。在 30s 严格超时约束下，这一差距更有意义——说明压缩后 agent 能在更短时间内完成决策。

### 2. 关键提升任务（ON 明显优于 OFF）

| 任务 | ON→OFF 成功率变化 | 说明 |
|---|---|---|
| **baseline-012** | 100% → 0% (+100pp) | OFF 全部超时，ON 全部通过 |
| **baseline-013** | 100% → 33% (+67pp) | ON 平均延迟 10.7s vs OFF 30s，提速 3× |
| **baseline-016** | 67% → 0% (+67pp) | OFF 全部超时，ON 2/3 通过 |
| **baseline-010** | 67% → 0% (+67pp) | OFF 全部超时，ON 2/3 通过 |
| **baseline-020** | 100% → 67% (+33pp) | ON 平均 13.3s vs OFF 25.9s |

这些任务的共同特征：涉及多步推理或工具调用，轨迹压缩有效减少了上下文膨胀导致的超时。

### 3. 回退任务（OFF 优于 ON）

| 任务 | ON→OFF 成功率变化 | 说明 |
|---|---|---|
| **smoke-002** | 33% → 100% (-67pp) | ON 2/3 超时 |
| **smoke-001** | 67% → 100% (-33pp) | ON 1/3 超时 |
| **baseline-009** | 0% → 33% (-33pp) | 双方均表现差 |
| **baseline-015** | 0% → 33% (-33pp) | 双方均表现差 |
| **baseline-019** | 0% → 33% (-33pp) | 双方均表现差 |

smoke-001/002 的回退值得关注：这些简单烟雾测试在 OFF 模式下反而更稳定，可能因为压缩在简单对话中引入了不必要的处理开销。baseline-009/015/019 双方均接近全失败，属于任务本身难度或模型兼容性问题。

### 4. 工具调用增加

ON 模式的平均工具调用（0.52）高于 OFF（0.27），说明 RE-TRAC 压缩后的上下文让 agent 更倾向于使用工具完成任务，而非因上下文溢出而直接放弃。这与成功率提升方向一致。

### 5. 与历史对照比较

| 指标 | 本轮 ON | 本轮 OFF | 历史 ON（120s） | 历史 OFF（120s） |
|---|---:|---:|---:|---:|
| Success rate | 66.67% | 55.00% | 100.00% | 93.33% |
| Avg latency | 22562 ms | 24483 ms | 28014 ms | 31348 ms |
| http_error | 20 | 27 | 0 | 4 |

本轮整体成功率低于历史基线，主要受 30s 超时（vs 历史 120s）和模型变更影响。但 ON vs OFF 的**相对优势方向一致**，且在严格超时下差距更大（+11.67pp vs +6.67pp），说明 RE-TRAC 在资源受限场景下的边际收益更高。

---

## 结论

在 30s 超时、`kimi-k2.5` 模型配置下：

1. **RE-TRAC 开启后成功率绝对提升 +11.67pp**，超时失败减少 7 次
2. **核心收益来自中等复杂度任务**（baseline-010/012/013/016/020），压缩使 agent 能在超时前完成多步推理
3. **简单任务存在小幅回退**（smoke-001/002），建议后续优化压缩触发阈值，对短对话跳过压缩
4. **与历史 120s 对照趋势一致**，验证了 RE-TRAC Phase A + Phase B 的工程价值

---

## 下一步建议

1. **优化压缩触发条件**：对 history ≤ 3 轮的短对话跳过压缩，避免简单任务回退
2. **提升超时容忍度**：评估将 `REQUEST_TIMEOUT_SECS` 提升到 60s 的可行性
3. **模型适配性测试**：在 Claude/GPT-4o 等模型上复跑，排除 kimi-k2.5 特异性
4. **人工质量评审**：按 `rubric.md` 对 ON/OFF 各抽 10 条做人工打分，补充自动指标
5. **固化回归评测**：将本对照流程集成到 CI，每次核心改动后自动复跑
